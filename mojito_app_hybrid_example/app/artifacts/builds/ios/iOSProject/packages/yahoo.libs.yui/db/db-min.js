YUI.add("db",function(h,g){function f(){}var b,e;b=f._TEMPLATES={CREATE_TABLE:"CREATE TABLE IF NOT EXISTS {storeId} ({schema});",DROP_TABLE:"DROP TABLE IF EXISTS {storeId};",UPDATE:"UPDATE {storeId} SET {updates};",UPDATE_WHERE:"UPDATE {storeId} SET {updates} WHERE {selector};",SELECT:"SELECT {keys} from {storeId};",SELECT_WHERE:"SELECT {keys} from {storeId} WHERE {selector};",DELETE:"DELETE FROM {storeId};",DELETE_WHERE:"DELETE FROM {storeId} WHERE {selector};",INSERT:"INSERT INTO {storeId} ({keys}) VALUES ({values});"};e=f._CONSTRAINTS={primary:"PRIMARY KEY",required:"NOT NULL"};f.prototype={addStore:function(i,l,m,o,k){var j=o,n=h.substitute(b.CREATE_TABLE,{storeId:i,schema:this._parseSchema(l)});if(m){j=function(p){this.addObjects(i,m,o,k);};}this.executeSql(n,null,j,k);},removeStore:function(i,l,j){var k=h.substitute(b.DROP_TABLE,{storeId:i});this.executeSql(k,null,l,j);},addObjects:function(i,l,k,j){this.executeSql(this._objs2sqlInsert(i,l).join(""),null,k,j);},getObjects:function(j,i,m,k){var l;if(i){l=h.substitute(b.SELECT_WHERE,{storeId:j,keys:"*",selector:this._parseSelector(i)});}else{l=h.substitute(b.SELECT,{storeId:j,keys:"*"});}this.executeSql(l,null,m,k);},updateObjects:function(j,l,i,n,k){var m;if(i){m=h.substitute(b.UPDATE_WHERE,{storeId:j,updates:this._objs2sqlUpdate(l),selector:this._parseSelector(i)});}else{m=h.substitute(b.UPDATE,{storeId:j,updates:this._objs2sqlUpdate(l)});}this.executeSql(m,null,n,k);},removeObjects:function(j,i,m,k){var l;if(i){l=h.substitute(b.DELETE_WHERE,{storeId:j,selector:this._parseSelector(i)});}else{l=h.substitute(b.DELETE,{storeId:j});}this.executeSql(l,null,m,k);},executeSql:function(l,j,k,i){j=j||[];this._invoke("executeQuery",{query:l,parameters:j},k,i);},_objs2sqlUpdate:function(n){var m="",l,k,j=n.length;for(l in n){if(n.hasOwnProperty(l)){m+=(m)?", ":"";m+=l+'="'+n[l].replace(/\"/g,"\\")+'"';}}return m;},_objs2sqlInsert:function(l,q){var p=[],k,m="",o,n,j=q.length;for(n=0;n<j;n++){k="";m="";for(o in q[n]){if(q[n].hasOwnProperty(o)){k+=(k===""?"":", ")+o;m+=(m==""?"":", ")+'"'+q[n][o].replace(/\"/g,"\\")+'"';}}p.push(h.substitute(b.INSERT,{storeId:l,keys:k,values:m}));}return p;},_parseSelector:function(i){var j,k="";for(j in i){if(i.hasOwnProperty(j)){k+=j+'="'+String(i[j]).replace(/\"/g,"\\")+'"';}}return k;},_parseSchema:function(k){var l="",n,j,m,i;for(j in k){if(k.hasOwnProperty(j)){l+=(l===""?"":", ")+j;for(m in k[j]){if(k[j].hasOwnProperty(m)){i=k[j][m];if(typeof i=="boolean"){l+=" "+(e[m]||m.toUpperCase());}else{l+=" "+(e[m]||m.toUpperCase()+" "+i);}}}}}return l;},_serviceId:"sSQLite"};function c(){this.init.apply(this,arguments);}h.extend(c,h.Handle,{_tId:"tDatabase",_options:{name:"",displayName:"",version:0,location:""},_events:{success:null,failure:null,upgrade:null},init:function(i){c.superclass.init.call(this,i);},_initEvents:function(i){c.superclass._initEvents.call(this,i);this._wrap("success",this._onSuccess,true);this._wrap("upgrade",this._onUpgrade);},_wrap:function(l,m,i){var k=this._events[l],j=this;if(i||k){this._events[l]=function(n){m.call(j,n,k);};}},_onSuccess:function(j,i){if(i){i(this);}},_onUpgrade:function(j,k){var i=this._upgradeTransaction(function(l){k(i);},function(){if(this._events.failure){this._events.failure(j);}});},_upgradeTransaction:function(j,i){return new c.Transaction({db:this,type:"upgrade",on:{success:j,failure:i}});},transaction:function(j,i){return new c.Transaction({db:this,on:{success:j,failure:i}});}});h.DB=c;h.mix(h.DB.prototype,f.prototype,true);function a(){this.init.apply(this,arguments);}h.extend(a,h.Handle,{_tId:"tTransaction",_options:{connectionId:null,type:""},_events:{success:null,failure:null},init:function(i){this.db=i.db;i.connectionId=this.db._handleId;a.superclass.init.call(this,i);},_initEvents:function(i){c.superclass._initEvents.call(this,i);this._wrap("success",this._onSuccess);},_wrap:function(l,m,i){var k=this._events[l],j=this;if(i||k){this._events[l]=function(n){m.call(j,n,k);};}},_onSuccess:function(j,i){i(this);},commit:function(j,i){this._invoke("commit",null,j,i);},rollback:function(j,i){this._invoke("rollback",null,j,i);}});h.mix(a.prototype,f.prototype,true);h.DB.Transaction=a;function d(){this.init.apply(this,arguments);}h.extend(d,h.Handle,{_serviceId:"sResultSet",_tId:"tResultSet",_options:{transactionId:null,connectionId:null},_events:{success:null,failure:null},init:function(j){var i={};if(j.transaction){i.transactionId=j.transaction._handleId;i.connectionId=j.transaction.db._handleId;}else{i.connectionId=j.db._handleId;}this._connectionId=i.connectionId;this._transactionId=i.transactionId;d.superclass.init.call(this,i);},getKeyCount:function(j,i){this._invoke("getColumnCount",null,j,i);},next:function(j,k,i){this._invoke("next",{count:j},k,i);},skip:function(j,k,i){this._invoke("skip",{count:j},k,i);}});h.DB.ResultSet=d;},"@VERSION@",{"requires":["handle","substitute"]});