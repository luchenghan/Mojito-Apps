YUI.add("bridge-base",function(e,t){function f(e){this._init(e)}var n="h_",r=e.Lang,i="destroyHandle",s="createHandle",o="cancelMethod",u="getContextId",a="checkAvailableServices";YUI.namespace("Env._BridgeContext"),e.mix(f,{addTransport:function(e,t,n){this._transports[e]=t,t.prototype.type=e,n&&f.setDefaultTransport(e)},hasTransport:function(e){return!!this._transports[e]},getTransport:function(e){return e=e||this._defaultTransport,this._transports[e]},setDefaultTransport:function(e){this.getTransport(e)&&(this._defaultTransport=e)},_transports:{}}),e.mix(f.prototype,{throttle:10,asyncCallbackTimeout:0,invokeMethod:function(e,t,n,r,i){var s=this._bId+":"+this._context.txId++,o=this._createMessage(s,e,t,n,r,i);return this.sendMessage(null,o),s},sendResponses:function(e){return YUI.Env._BridgeContext[this._transport.type].sendResponses(e)},getRequests:function(){return YUI.Env._BridgeContext[this._transport.type].getRequests()},_invokeCallback:function(e){var t=this,n=this._context.contextId,r=this._callbackMap,i,s,o,u,a;if(!n&&this._isContextIdResponse(e)||e.d&&e.d[0]===n)o=e.i,i=r[o],i&&(s=i[e.c],(!e.p||e.p.c!==!1)&&delete r[o],s&&(e.hasOwnProperty("a")?(a=e.a,u=this._bind(s,null,a)):u=this._bind(s,null),setTimeout(u,t.asyncCallbackTimeout)))},destroy:function(){var t=this._context,n;this._transport.destroy(),delete t.bridges[this.id],e.Object.size(t.bridges)===0&&(n=t.throttleTimer,n&&n.cancel(),YUI.Env._BridgeContext.bell=null)},sendMessage:function(e,t){var n=this._context,r=n.contextId;e&&(t.d=e),r?(t.s=[r],n.reqQueue.push(t),this._throttledSend()):this._isContextIdInvocation(t)?(n.reqQueue.push(t),this._transport.sendSecureMessage()):n.tmpQueue.push(t)},_sendMessages:function(e){var t,n,r,i=this._context,s=i.contextId;for(t=0,n=e.length;t<n;t++)r=e[t],r.s||(r.s=[s]),this._context.reqQueue.push(r);this._throttledSend()},createHandle:function(t,r,i,o,u){var a=e.guid(n),f=this._imHandleArgs(a),l=this._imCallbacks(o,u);return r&&(f.t=r),i&&(f.a=i),this.invokeMethod(t,s,f,l),a},checkAvailableServices:function(e,t,n){this.invokeMethod(null,a,e,this._imCallbacks(t,n))},destroyHandle:function(e,t,n){var r=this._imHandleArgs(e),s=this._imCallbacks(t,n);this.invokeMethod(null,i,r,s)},cancelMethod:function(e,t,n){var r={i:e},i=this._imCallbacks(t,n);i&&(i.success=this._onCancelMethodSuccess(e,i.success)),this.invokeMethod(null,o,r,i)},_onCancelMethodSuccess:function(e,t){var n=this,r=function(){n._callbackMap[e]&&delete n._callbackMap[e],t&&t.apply(this,arguments)};return r},_bind:function(e,t,n){var i;return arguments.length===2?i=function(){e.call(t)}:r.isArray(n)?i=function(){e.apply(t,n)}:i=function(){e.call(t,n)},i},_imHandleArgs:function(e){return{o:e}},_imCallbacks:function(e,t){var n;if(r.isObject(e,!0))n=e;else if(e||t)n={},e&&(n.success=e),t&&(n.failure=t);return n},_throttledSend:function(){var t=this._context,n=t.reqQueue.length>0,r=t.throttled,i=t.throttle;n&&!t.waitingForAck&&(r||(t.throttled=!0,t.waitingForAck=!0,this._transport.sendMessage()),t.throttleTimer||(t.throttleTimer=e.later(i,this,function(){t.throttled=!1,t.throttleTimer=null,this._throttledSend()})))},_initTransport:function(t){var n=e.BridgeBase.getTransport(t.type);t.bridge=this,this._transport=new n(t),this.type=this._transport.type},_createMessage:function(e,t,n,r,i,s){var o={},u;return e&&(o.i=e),t&&(o.h=t),n&&(o.m=n),r&&(o.a=r),u=this._storeCallbacks(o.i,i),u&&(o.c=u),s&&(o.p=s),o},_storeCallbacks:function(e,t){var n=this._callbackMap,r,i;if(t&&e&&!n[e]){r=[];for(i in t)t.hasOwnProperty(i)&&(r[r.length]=i);r.length>0&&(n[e]=t)}return!r||r.length===0?null:r},_init:function(t){t=t||{},e.mix(this,t,!0,["throttle","asyncCallbackTimeout"]),this.id=e.guid(),this._initCBMap(t),this._initTransport(t),this._initContext(this._transport),this._initContextId(t)},_initCBMap:function(){this._callbackMap={}},_isContextIdInvocation:function(e){return e.i&&!e.s&&!e.h&&e.m===u},_isContextIdResponse:function(e){return!e.d||e.d.length===0},_initContextId:function(){var e=this,t=e._context;!t.contextId&&!t.waitingForContextId&&(e.invokeMethod(null,u,null,{success:function(n){t.waitingForContextId=!1,t.contextId=n.id,t.tmpQueue&&(e._sendMessages(t.tmpQueue),t.tmpQueue=[])},failure:function(e){t.waitingForContextId=!1}}),t.waitingForContextId=!0)},_initContext:function(e){var t=this.type;YUI.Env._BridgeContext[t]||(YUI.Env._BridgeContext[t]={txId:0,bId:0,contextId:null,throttle:this.throttle,bridges:{},reqQueue:[],tmpQueue:[],throttled:!1,waitingForAck:!1,format:e.format,parse:e.parse,getRequests:function(){var e=this.reqQueue;return this.reqQueue=[],this.waitingForAck=!1,this.format(e)},sendResponses:function(e){var t,n,r,i,s,o=e,u;typeof e=="string"&&(o=this.parse(e));if(o)for(t=0,n=o.length;t<n;t++)s=o[t],i=s.i,r=i.substring(0,i.indexOf(":")),u=this.bridges[r],u&&u._invokeCallback(s)}}),this._context=YUI.Env._BridgeContext[t],this._bId=this._context.bId++,this._context.bridges[this._bId]=this}}),e.BridgeBase=f},"@VERSION@",{requires:["yui-base","json"]});
